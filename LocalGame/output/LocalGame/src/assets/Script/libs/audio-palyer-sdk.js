var hlgame;!function(o){!function(o){function t(){null!=c&&c.off(cc.Node.EventType.TOUCH_START,e);var o=cc.director.getScene();c=o.children[0],n("after scene launch:",o.name),c.on(cc.Node.EventType.TOUCH_START,e)}function e(){if(null!=s){n("now you can autoPlay without iframe!"),y=!0,cc.audioEngine.play(s,!1,0),c.off(cc.Node.EventType.TOUCH_START,e),cc.director.off(cc.Director.EVENT_AFTER_SCENE_LAUNCH,t);var o;Object.keys(f).forEach(function(t){(o=f[t]).triggerStop()});var i;Object.keys(h).forEach(function(o){(i=h[o]).forEach(function(o){o.play()}),i.length=0,delete h[o]})}}function i(){return d++}function n(){for(var o=[],t=0;t<arguments.length;t++)o[t]=arguments[t];cc.info("[audio-player-sdk] ",o.join(" "))}function u(o,t,e){void 0===t&&(t=!1),void 0===e&&(e=1);var i=cc.url.raw(o),u=m.borrow(i,t,e),a=h[i];return null==a?null==cc.loader.getRes(i)?(n("start load:",i),null==(a=p[i])?(a=[g.borrow(u)],p[i]=a):a.push(g.borrow(u)),cc.audioEngine.preload(i,function(){null==s&&(s=i),delete p[i],y?(a.forEach(function(o){o.play()}),a.length=0):(h[i]=a,r(i))})):y?I.borrow(u).play():(null==s&&(s=i),a=[g.borrow(u)],h[i]=a,r(i)):a.push(g.borrow(u)),u.uuid}function r(o){if(null!=a){var t={action:"call",method:"playSound",args:{options:o}};n("postMessage:",JSON.stringify(t)),a.postMessage(t,"*")}}var a,s,c,d=0,l="",f={},p={},h={},_={},y=!(cc.sys.os===cc.sys.OS_IOS&&cc.sys.isMobile&&cc.sys.isBrowser&&!window.nativeApp);cc.sys.isBrowser&&window.parent!==window.self&&(a=window.parent,window.addEventListener("message",function(o){var t=o.data;if(null!=t)switch(n("recieve from iframe:",JSON.stringify(t)),t.method){case"playSoundRes":try{var e=h[t.args.options];delete h[t.args.options],null!=e&&(e.forEach(function(o){o.play()}),e.length=0)}catch(o){n("playSoundRes error:",o)}}else n("recieve from iframe: content is null")})),y||cc.director.on(cc.Director.EVENT_AFTER_SCENE_LAUNCH,t);var m=function(){function o(){this._uuid=-1,this._startTime=NaN,this._loop=!1,this._volume=1,this._paused=!1,this._playFromIframe=!1}return o.borrow=function(t,e,n){var u=o.POOL.pop()||new o;return u._uuid=i(),u._startTime=Date.now(),u._url=t,u._loop=e,u._volume=n,u._paused=!1,u._playFromIframe=!1,u},Object.defineProperty(o.prototype,"uuid",{get:function(){return this._uuid},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"startTime",{get:function(){return this._startTime},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"url",{get:function(){return this._url},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"loop",{get:function(){return this._loop},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"volume",{get:function(){return this._volume},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"paused",{get:function(){return this._paused},set:function(o){this._paused=o},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"playFromIframe",{get:function(){return this._playFromIframe},set:function(o){this._playFromIframe=o},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"pastTime",{get:function(){return(Date.now()-this._startTime)/1e3},enumerable:!0,configurable:!0}),o.prototype.return=function(){o.POOL.push(this)},o.POOL=[],o}(),g=function(){function o(){}return o.borrow=function(t){var e=o.POOL.pop()||new o;return e._audioInfo=t,_[t.uuid]=e,e},o.prototype.play=function(){I.borrow(this._audioInfo).play(),this._audioInfo=null,o.POOL.push(this)},o.prototype.pause=function(){this._audioInfo.paused=!0},o.prototype.resume=function(){this._audioInfo.paused=!1},o.prototype.stop=function(){delete _[this._audioInfo.uuid];var t=p,e=p[this._audioInfo.url];if(null==e&&(t=h,e=h[this._audioInfo.url]),null!=e){var i=e.indexOf(this);i>-1&&(e.splice(i,1),0===e.length&&delete t[this._audioInfo.url])}this._audioInfo.return(),this._audioInfo=null,o.POOL.push(this)},o.POOL=[],o}(),I=function(){function o(){}return o.borrow=function(t){var e=o.POOL.pop()||new o;return e._audioInfo=t,e._audioId=-1,_[t.uuid]=e,e},Object.defineProperty(o.prototype,"currentTime",{get:function(){return-1===this._audioId?0:cc.audioEngine.getCurrentTime(this._audioId)},enumerable:!0,configurable:!0}),o.prototype.play=function(){if(-1===this._audioId){this._startPlayTime=Date.now(),f[this._audioInfo.uuid]=this,this._audioId=cc.audioEngine.play(this._audioInfo.url,this._audioInfo.loop,0);var o=this._audioInfo.pastTime;if(this._duration=cc.audioEngine.getDuration(this._audioId),this._duration<=o&&!this._audioInfo.loop)return void this.stop();cc.audioEngine.setVolume(this._audioId,this._audioInfo.volume),cc.audioEngine.setCurrentTime(this._audioId,this._duration<o?0:o),this._audioInfo.volume||cc.audioEngine.setFinishCallback(this._audioId,this.playEnd.bind(this)),this._audioInfo.paused&&this.pause()}},o.prototype.triggerStop=function(){!this._audioInfo.loop&&this._duration<=(Date.now()-this._startPlayTime)/1e3&&this.stop()},o.prototype.stop=function(){this._audioId>-1&&cc.audioEngine.stop(this._audioId),this.playEnd()},o.prototype.pause=function(){this._audioId>-1?cc.audioEngine.pause(this._audioId):this._audioInfo.paused=!0},o.prototype.resume=function(){this._audioId>-1?cc.audioEngine.resume(this._audioId):this._audioInfo.paused=!1},o.prototype.playEnd=function(){delete f[this._audioInfo.uuid],delete _[this._audioInfo.uuid],this._audioInfo.return(),this._audioInfo=null,this._audioId=-1,o.POOL.push(this)},o.POOL=[],o}();o.setAudioDirPath=function(o){l=o,o.lastIndexOf("/")!==o.length-1&&(l+="/")},o.play=u,o.playByName=function(o,t,e,i){return void 0===t&&(t=!1),void 0===e&&(e=1),null!=i?u(i+o,t,e):u(l+o,t,e)},o.getCurrentTime=function(o){var t=f[o];return null!=t?t.currentTime:0},o.stop=function(o){var t=_[o];null!=t&&t.stop()},o.pauseAll=function(){var o;Object.keys(_).forEach(function(t){(o=_[t]).pause()})},o.resumeAll=function(){var o;Object.keys(_).forEach(function(t){(o=_[t]).resume()})}}(o.audio||(o.audio={}))}(hlgame||(hlgame={}));